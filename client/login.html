<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç™»å½• Â· æƒ…ç»ªå‚¨å­˜ç½</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js -->
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    /* å¿ƒå½¢å›¾æ ‡é¢œè‰² */
    .heart { color: #ec4899; }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-pink-50 min-h-screen flex items-center justify-center">

  <div class="bg-white bg-opacity-80 backdrop-blur-md p-8 rounded-3xl shadow-xl w-80" x-data="loginPage()">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-pink-500 flex items-center justify-center">
        <span>ğŸ</span>
        <span class="ml-2">æƒ…ç»ªå‚¨å­˜ç½</span>
        <span class="ml-2 heart">â¤</span>
      </h1>
    </div>

    <!-- Email -->
    <label class="block mb-2">
      <span class="text-gray-700 font-medium">ğŸ“§ é‚®ç®±</span>
      <input
        class="mt-1 w-full px-4 py-2 border border-pink-200 rounded-lg focus:ring focus:ring-pink-200 focus:outline-none"
        x-model="email"
        type="email"
        placeholder="ä½ çš„é‚®ç®±" />
    </label>

    <!-- Password -->
    <label class="block mb-4">
      <span class="text-gray-700 font-medium">ğŸ”’ å¯†ç </span>
      <input
        class="mt-1 w-full px-4 py-2 border border-pink-200 rounded-lg focus:ring focus:ring-pink-200 focus:outline-none"
        x-model="password"
        type="password"
        placeholder="è¾“å…¥å¯†ç " />
    </label>

    <!-- Remember Email -->
    <div class="flex items-center mb-4">
      <input id="remember" type="checkbox" class="mr-2" x-model="remember"/>
      <label for="remember" class="text-sm text-gray-600">è®°ä½æˆ‘çš„é‚®ç®±</label>
    </div>

    <!-- Buttons -->
    <button
      class="w-full py-2 mb-2 bg-gradient-to-r from-pink-400 to-purple-400 text-white rounded-lg hover:from-pink-500 hover:to-purple-500 shadow transition"
      @click="login">
      ç™»å½•
    </button>
    <button
      class="w-full py-2 mb-4 bg-white border border-pink-300 text-pink-500 rounded-lg hover:bg-pink-50 shadow"
      @click="register">
      æ³¨å†Œ
    </button>

    <!-- Error Message -->
    <p class="text-center text-red-500 mb-2" x-text="err"></p>
  </div>

  <script>
    const API = 'https://emotion-jar-60yp.onrender.com';
    const tokenKey = 'ej_token';
    const emailKey = 'ej_email';

    function loginPage() {
      return {
        // é¡µé¢åŠ è½½æ—¶ï¼Œå°è¯•ä» localStorage å–å›ä¸Šæ¬¡è®°ä½çš„é‚®ç®±
        email: localStorage.getItem(emailKey) || '',
        password: '',
        remember: !!localStorage.getItem(emailKey),
        err: '',

        async login() {
          await this._submit('login');
        },
        async register() {
          await this._submit('register');
        },
        async _submit(path) {
          if (!this.email || !this.password) {
            this.err = 'é‚®ç®±å’Œå¯†ç ä¸èƒ½ä¸ºç©º';
            return;
          }
          this.err = '';
          const res = await fetch(`${API}/auth/${path}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: this.email,
              password: this.password
            })
          });
          const data = await res.json();
          if (data.token) {
            // å­˜ token
            localStorage.setItem(tokenKey, data.token);
            // æ ¹æ® remember å¤é€‰æ¡†å†³å®šæ˜¯å¦è®°ä½é‚®ç®±
            if (this.remember) {
              localStorage.setItem(emailKey, this.email);
            } else {
              localStorage.removeItem(emailKey);
            }
            // è·³è½¬é¦–é¡µ
            location.href = 'index.html';
          } else if (path === 'register' && data.ok) {
            // æ³¨å†Œåè‡ªåŠ¨ç™»å½•
            await this._submit('login');
          } else {
            this.err = data.error || 'è¯·æ±‚å¤±è´¥';
          }
        }
      };
    }
  </script>
</body>
</html>
